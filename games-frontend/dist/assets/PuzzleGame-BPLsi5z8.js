import{r as w,j as e,u as W}from"./index-DlPqXysq.js";import{m as L}from"./proxy-CdiwZt7z.js";import{c as D}from"./confetti.module-oQXWb4Lk.js";function B({id:a,image:s,width:i,height:d,x:b,y:j,boardWidth:h,boardHeight:k,currentX:z,currentY:S,shape:C={top:0,right:0,bottom:0,left:0},onDragEnd:A,isLocked:n}){const $=Math.min(i,d)*.25,x=$,l=i+x*2,v=d+x*2,p=w.useMemo(()=>{const{top:y,right:g,bottom:f,left:M}=C,c=x,o=x,m=i,r=d,t=$;let u=`M${c},${o} `;if(y===0)u+=`L${c+m},${o} `;else{const N=-y;u+=`L${c+m/2-t/1.5},${o} `,u+=`C${c+m/2-t},${o+N*t} ${c+m/2+t},${o+N*t} ${c+m/2+t/1.5},${o} `,u+=`L${c+m},${o} `}if(g===0)u+=`L${c+m},${o+r} `;else{const N=g;u+=`L${c+m},${o+r/2-t/1.5} `,u+=`C${c+m+N*t},${o+r/2-t} ${c+m+N*t},${o+r/2+t} ${c+m},${o+r/2+t/1.5} `,u+=`L${c+m},${o+r} `}if(f===0)u+=`L${c},${o+r} `;else{const N=f;u+=`L${c+m/2+t/1.5},${o+r} `,u+=`C${c+m/2+t},${o+r+N*t} ${c+m/2-t},${o+r+N*t} ${c+m/2-t/1.5},${o+r} `,u+=`L${c},${o+r} `}if(M===0)u+="Z ";else{const N=-M;u+=`L${c},${o+r/2+t/1.5} `,u+=`C${c+N*t},${o+r/2+t} ${c+N*t},${o+r/2-t} ${c},${o+r/2-t/1.5} `,u+="Z "}return u},[i,d,C,x,$]);return e.jsx(L.div,{drag:!n,dragMomentum:!1,onDragEnd:(y,g)=>A(a,g),animate:{x:z-x,y:S-x,zIndex:n?10:20,scale:n?1:1.05},whileDrag:{zIndex:50,scale:1.1,cursor:"grabbing"},whileHover:n?{}:{scale:1.1,zIndex:40,cursor:"grab"},className:`absolute ${n?"shadow-none":"drop-shadow-lg"}`,style:{width:l,height:v,top:0,left:0},children:e.jsxs("svg",{width:l,height:v,viewBox:`0 0 ${l} ${v}`,className:"block",style:{overflow:"visible"},children:[e.jsxs("defs",{children:[e.jsx("clipPath",{id:`clip-${a}`,children:e.jsx("path",{d:p})}),e.jsxs("filter",{id:`bevel-${a}`,x:"-20%",y:"-20%",width:"140%",height:"140%",children:[e.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),e.jsx("feSpecularLighting",{in:"blur",surfaceScale:"6",specularConstant:"1.5",specularExponent:"12",lightingColor:"white",result:"specOut",children:e.jsx("fePointLight",{x:"-5000",y:"-5000",z:"80"})}),e.jsx("feOffset",{in:"SourceAlpha",dx:"2",dy:"2",result:"offsetAlpha"}),e.jsx("feComposite",{in:"offsetAlpha",in2:"SourceAlpha",operator:"out",result:"shadowMask"}),e.jsx("feFlood",{floodColor:"#000",floodOpacity:"0.5",result:"shadowColor"}),e.jsx("feComposite",{in:"shadowColor",in2:"shadowMask",operator:"in",result:"shadow"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"shadow"}),e.jsx("feMergeNode",{in:"specOut"})]}),e.jsx("feComposite",{in2:"SourceAlpha",operator:"in",result:"bevel"})]})]}),e.jsx("image",{href:s,x:-(b-x),y:-(j-x),width:h,height:k,clipPath:`url(#clip-${a})`,preserveAspectRatio:"none"}),e.jsx("path",{d:p,fill:"black",fillOpacity:"1",filter:`url(#bevel-${a})`,style:{pointerEvents:"none"}}),e.jsx("path",{d:p,fill:"none",stroke:"rgba(0,0,0,0.2)",strokeWidth:"1",style:{pointerEvents:"none"}}),e.jsx("path",{d:p,fill:"none",stroke:"rgba(255,255,255,0.4)",strokeWidth:"0.5",style:{pointerEvents:"none"}})]})})}const I=()=>{if(!(window.AudioContext||window.webkitAudioContext))return;const s=P();if(!s)return;s.state==="suspended"&&s.resume();const i=s.createOscillator(),d=s.createGain();i.connect(d),d.connect(s.destination),i.type="sine",i.frequency.setValueAtTime(400,s.currentTime),i.frequency.exponentialRampToValueAtTime(50,s.currentTime+.1),d.gain.setValueAtTime(.5,s.currentTime),d.gain.exponentialRampToValueAtTime(.01,s.currentTime+.15),i.start(s.currentTime),i.stop(s.currentTime+.15)},H=()=>{const a=P();if(!a)return;a.state==="suspended"&&a.resume(),[523.25,659.25,783.99,1046.5,783.99,1046.5].forEach((i,d)=>{const b=a.createOscillator(),j=a.createGain();b.connect(j),j.connect(a.destination),b.type=d%2===0?"sine":"triangle",b.frequency.value=i;const h=a.currentTime+d*.1,k=.3;j.gain.setValueAtTime(0,h),j.gain.linearRampToValueAtTime(.2,h+.05),j.gain.exponentialRampToValueAtTime(.001,h+k),b.start(h),b.stop(h+k)})};let T=null;function P(){if(!T){const a=window.AudioContext||window.webkitAudioContext;a&&(T=new a)}return T}const X=()=>{const a=P();if(!a)return;a.state==="suspended"&&a.resume();const s=a.createBuffer(1,1,22050),i=a.createBufferSource();i.buffer=s,i.connect(a.destination),i.start(0)};function Y({image:a,difficulty:s,showBackground:i,onWin:d}){const[b,j]=w.useState([]),[h,k]=w.useState({width:0,height:0,top:0,left:0}),[z,S]=w.useState(!1),C=w.useRef(null);w.useEffect(()=>{const n=new Image;n.src=a,n.onload=()=>{const $=window.innerWidth>window.innerHeight,x=window.innerWidth*($?.6:.9),l=window.innerHeight*($?.9:.65),v=n.width/n.height;let p=x,y=p/v;y>l&&(y=l,p=y*v);const g=(window.innerHeight-y)/2,f=(window.innerWidth-p)/2;k({width:p,height:y,top:g,left:f});const M=Array(s).fill(0).map(()=>Array(s).fill(0).map(()=>({top:0,right:0,bottom:0,left:0})));for(let r=0;r<s;r++)for(let t=0;t<s-1;t++){const u=Math.random()>.5?1:-1;M[r][t].right=u,M[r][t+1].left=-u}for(let r=0;r<s-1;r++)for(let t=0;t<s;t++){const u=Math.random()>.5?1:-1;M[r][t].bottom=u,M[r+1][t].top=-u}const c=[],o=p/s,m=y/s;for(let r=0;r<s;r++)for(let t=0;t<s;t++)c.push({id:`${r}-${t}`,row:r,col:t,width:o,height:m,shape:M[r][t],targetX:f+t*o,targetY:g+r*m,currentX:$?Math.random()<.5?Math.random()*(f-o):f+p+Math.random()*(window.innerWidth-(f+p)-o):Math.random()*(window.innerWidth-o),currentY:$?Math.random()*(window.innerHeight-m):g+y+Math.random()*(window.innerHeight-(g+y)-m),isLocked:!1});j(c),S(!0)}},[a,s]);const A=(n,$)=>{j(x=>{const l=x.find(g=>g.id===n);if(!l)return x;const v=l.currentX+$.offset.x,p=l.currentY+$.offset.y;if(Math.hypot(v-l.targetX,p-l.targetY)<60){I();const g=x.map(f=>f.id===n?{...f,currentX:f.targetX,currentY:f.targetY,isLocked:!0}:f);return g.every(f=>f.isLocked)&&(H(),setTimeout(d,500)),g}else return x.map(g=>g.id===n?{...g,currentX:v,currentY:p}:g)})};return z?e.jsx("div",{ref:C,className:"w-full h-full relative overflow-hidden backdrop-blur-sm bg-black/10",children:e.jsxs(L.div,{drag:!0,dragMomentum:!0,className:"w-full h-full cursor-grab active:cursor-grabbing transform-gpu",style:{transformStyle:"preserve-3d"},children:[e.jsx("div",{className:"absolute border-2 border-white/20 bg-white/5 rounded-lg",style:{width:h.width,height:h.height,top:h.top,left:h.left},children:i&&e.jsx("div",{className:"w-full h-full opacity-20 bg-contain bg-no-repeat",style:{backgroundImage:`url(${a})`,backgroundSize:`${h.width}px ${h.height}px`}})}),b.map(n=>e.jsx(B,{id:n.id,image:a,width:n.width,height:n.height,x:n.targetX-h.left,y:n.targetY-h.top,boardWidth:h.width,boardHeight:h.height,currentX:n.currentX,currentY:n.currentY,onDragEnd:A,isLocked:n.isLocked,shape:n.shape},n.id))]})}):e.jsx("div",{className:"text-white",children:"Loading puzzle..."})}const E=["https://images.unsplash.com/photo-1546182990-dffeafbe841d?w=800&q=80","https://storage.googleapis.com/purejax-data-1234/puzzle-game/Kitkat.png","https://storage.googleapis.com/purejax-data-1234/puzzle-game/bourbon.png"];function R({onStart:a}){const[s,i]=w.useState(E[0]),[d,b]=w.useState(3),[j,h]=w.useState(!0),[k,z]=w.useState(E),[S,C]=w.useState(!1),[A,n]=w.useState(null);w.useEffect(()=>{$()},[]);const $=async()=>{try{const l=await fetch("/api/images");if(!l.ok)throw new Error("Failed to fetch images");const v=await l.json();z(v.images)}catch(l){console.error("Error fetching images:",l),console.error("Fetch URL:","/api/images"),z(E)}},x=async l=>{const v=l.target.files[0];if(v){C(!0),n(null);try{const p=new FormData;p.append("image",v);const y=await fetch("/api/upload",{method:"POST",body:p});if(!y.ok){const f=await y.json();throw new Error(f.error||"Upload failed")}const g=await y.json();await $(),i(g.url)}catch(p){console.error("Error uploading image:",p),console.error("Upload URL:","/api/upload"),n(p.message)}finally{C(!1),l.target.value=""}}};return e.jsxs("div",{className:"flex flex-col items-center gap-10 p-8 w-full h-full overflow-y-auto z-10",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h1",{className:"text-6xl font-black bg-gradient-to-r from-pink-400 via-purple-400 to-indigo-400 bg-clip-text text-transparent drop-shadow-2xl animate-pulse",children:"Puzzle Snap"}),e.jsx("p",{className:"text-gray-300 text-lg font-light tracking-wide",children:"Unleash your inner puzzle master"})]}),e.jsxs("div",{className:"flex flex-col gap-6 w-full max-w-2xl bg-white/5 backdrop-blur-xl p-8 rounded-3xl border border-white/10 shadow-2xl",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-8 rounded-full bg-pink-500 flex items-center justify-center text-sm",children:"1"}),"Choose an Image"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:k.map((l,v)=>e.jsxs("button",{onClick:()=>i(l),className:`group relative rounded-2xl overflow-hidden aspect-square border-4 transition-all duration-300 ${s===l?"border-pink-500 scale-105 shadow-[0_0_20px_rgba(236,72,153,0.5)]":"border-transparent opacity-60 hover:opacity-100 hover:scale-105"}`,children:[e.jsx("img",{src:l,alt:`Puzzle ${v}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors"})]},v))}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-pink-600 to-purple-600 rounded-lg blur opacity-30 group-hover:opacity-100 transition duration-200"}),e.jsxs("label",{className:`relative flex items-center justify-center w-full px-6 py-4 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-800 transition-colors border border-white/10 ${S?"opacity-50 cursor-not-allowed":""}`,children:[S?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3 text-pink-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-gray-300 font-medium",children:"Uploading..."})]}):e.jsx("span",{className:"text-gray-300 font-medium group-hover:text-white transition-colors",children:"Upload Custom Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:x,className:"hidden",disabled:S})]})]}),A&&e.jsx("div",{className:"mt-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsxs("p",{className:"text-red-400 text-sm font-medium",children:["‚ö†Ô∏è ",A]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-8 rounded-full bg-violet-500 flex items-center justify-center text-sm",children:"2"}),"Select Difficulty ",e.jsxs("span",{className:"text-violet-300 font-normal",children:["(",d,"x",d,")"]})]}),e.jsxs("div",{className:"relative pt-6 pb-2",children:[e.jsx("input",{type:"range",min:"2",max:"6",value:d,onChange:l=>b(Number(l.target.value)),className:"w-full h-3 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-violet-500 hover:accent-violet-400 transition-all"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400 font-medium mt-2 uppercase tracking-wider",children:[e.jsx("span",{children:"Easy Peasy"}),e.jsx("span",{children:"Brain Teaser"}),e.jsx("span",{children:"Impossible"})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-slate-800/50 p-4 rounded-xl border border-white/5",children:[e.jsx("label",{className:"text-white font-medium",children:"Show Background Hint"}),e.jsx("button",{onClick:()=>h(!j),className:`relative w-14 h-8 rounded-full transition-colors duration-300 ${j?"bg-pink-500":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-1 left-1 w-6 h-6 bg-white rounded-full transition-transform duration-300 ${j?"translate-x-6":"translate-x-0"}`})})]})]}),e.jsxs("button",{onClick:()=>{X(),a(s,d,j)},className:"mt-4 w-full py-5 bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-500 hover:to-fuchsia-500 rounded-2xl font-black text-2xl text-white shadow-[0_10px_40px_-10px_rgba(139,92,246,0.6)] transform hover:-translate-y-1 transition-all duration-300 active:scale-95 flex items-center justify-center gap-3 uppercase tracking-widest",children:["Start Game",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"})})]})]}),e.jsx("p",{className:"text-slate-500 text-sm font-medium",children:"v1.0 ‚Ä¢ Designed for Puzzlers"})]})}function U({onReset:a,image:s}){return w.useEffect(()=>{const d=Date.now()+3e3,b=()=>{D({particleCount:3,angle:60,spread:55,origin:{x:0},colors:["#a786ff","#fd8bbc","#eca184","#f8deb1"]}),D({particleCount:3,angle:120,spread:55,origin:{x:1},colors:["#a786ff","#fd8bbc","#eca184","#f8deb1"]}),Date.now()<d&&requestAnimationFrame(b)};b()},[]),e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 gap-10 text-center h-full w-full bg-black/40 backdrop-blur-sm",children:[e.jsxs(L.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",bounce:.5},className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-400 blur-3xl opacity-20 animate-pulse"}),e.jsx("h1",{className:"relative text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-orange-400 to-red-400 drop-shadow-sm mb-2",children:"Puzzle Solved!"}),e.jsx("p",{className:"text-white/80 text-xl font-medium tracking-widest uppercase",children:"Spectacular Performance"})]}),e.jsx(L.div,{className:"relative rounded-2xl overflow-hidden shadow-2xl border-4 border-white/20 bg-black/20 backdrop-blur-xl p-2 max-w-4xl",initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},children:e.jsx("img",{src:s,alt:"Completed Puzzle",className:"max-h-[50vh] object-contain rounded-lg"})}),e.jsxs(L.button,{onClick:a,initial:{y:20,opacity:0},animate:{y:0,opacity:1},whileHover:{scale:1.05},whileTap:{scale:.95},transition:{delay:.4},className:"px-10 py-4 bg-white text-violet-900 rounded-full font-black text-xl hover:bg-violet-50 transition-colors shadow-[0_0_30px_rgba(255,255,255,0.3)] flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),"Play Again"]})]})}function O(){const a=W(),[s,i]=w.useState("menu"),[d,b]=w.useState(null),[j,h]=w.useState(3),[k,z]=w.useState(!0),S=(n,$,x)=>{b(n),h($),z(x),i("playing")},C=()=>{i("won")},A=()=>{i("menu"),b(null)};return e.jsxs("div",{className:"puzzle-container",children:[e.jsx("button",{onClick:()=>a("/"),className:"home-btn",children:"üè†"}),s==="menu"&&e.jsx(R,{onStart:S}),s==="playing"&&e.jsx(Y,{image:d,difficulty:j,showBackground:k,onWin:C}),s==="won"&&e.jsx(U,{onReset:A,image:d})]})}export{O as default};
