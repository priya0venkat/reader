games.verma7.com {
    # Serve the landing page at root
    root * /home/abhishekverma/reader
    file_server

    # Global Auth
    handle /auth/* {
        reverse_proxy 127.0.0.1:3001
    }

    # Serve Phonics Reader
    handle_path /reader/* {
        forward_auth localhost:3001 {
            uri /auth/check
        }
        root * /home/abhishekverma/reader/reader/frontend/dist
        file_server
        try_files {path} /index.html
    }

    # Serve Washing Machine game
    handle_path /washing-machine/* {
        forward_auth localhost:3001 {
            uri /auth/check
        }
        root * /home/abhishekverma/reader/washing-machine/dist
        file_server
        try_files {path} /index.html
    }

    # Serve US Map game
    handle_path /us-map-game/* {
        forward_auth localhost:3001 {
            uri /auth/check
        }
        root * /home/abhishekverma/reader/us-map-game/dist
        file_server
        try_files {path} /index.html
    }

    # Serve World Map game
    handle_path /world-map-game/* {
        forward_auth localhost:3001 {
            uri /auth/check
        }
        root * /home/abhishekverma/reader/world-map-game/dist
        file_server
        try_files {path} /index.html
    }

    # Serve Food Classification game
    handle_path /food-classification-game/* {
        forward_auth localhost:3001 {
            uri /auth/check
        }
        root * /home/abhishekverma/reader/food-classification-game/dist
        file_server
        try_files {path} /index.html
    }

    # Serve Puzzle game - API endpoints (no auth required)
    handle_path /puzzle-game/api/* {
        reverse_proxy 127.0.0.1:3002
    }
    
    # Serve Puzzle game - Frontend (auth required)
    handle_path /puzzle-game/* {
        forward_auth localhost:3001 {
            uri /auth/check
        }
        root * /home/abhishekverma/reader/puzzle-game/dist
        try_files {path} /index.html
        file_server
    }
    
    # Handle auth errors (redirect to login page)
    handle_errors {
        @401 {
            expression {http.error.status_code} == 401
        }
        redir @401 /unauthorized.html
    }
}
